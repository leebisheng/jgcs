<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" > 
	<meta http-equiv="Content-Type" content="text/css .css; charset=utf-8" > 
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>云南酷联科技有限公司</title>
	
	<!--  JQUERY -->
	<script src="../bootstrap-3.3.7-dist/js/jquery-3.1.1.min.js"></script>

	<!--  BOOTSTRAP -->
	<link href="../bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="../bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

  <!--  JQUERY-UI (only sortable and datepicker is needed) -->
	<link rel="stylesheet" type="text/css" href="../jquery-ui-1.12.1/jquery-ui.min.css">
	<script type="text/javascript" src="../jquery-ui-1.12.1/jquery-ui.min.js"></script>
	
	<!--  if timepicker is used in filters -->
	<link rel="stylesheet" type="text/css" href="../timepicker/jquery-ui-timepicker-addon.min.css"/>
	<script type="text/javascript" src="../timepicker/jquery-ui-timepicker-addon.min.js"></script>
	<!--  if touch event support is needed (mobile devices) -->
	<script type="text/javascript" src="../timepicker/jquery.ui.touch-punch.min.js"></script>
 
	<!--  PAGINATION plugin -->
	<link rel="stylesheet" type="text/css" href="../bs_pagination/jquery.bs_pagination.min.css">
	<script type="text/javascript" src="../bs_pagination/jquery.bs_pagination.min.js"></script>
	<script type="text/javascript" src="../bs_pagination/localization/en.min.js"></script>

	<!--  FILTERS plugin --> 
	<link rel="stylesheet" type="text/css" href="../jui_filter_rules/jquery.jui_filter_rules.bs.min.css">
	<script type="text/javascript" src="../jui_filter_rules/jquery.jui_filter_rules.min.js"></script>
	<script type="text/javascript" src="../jui_filter_rules/localization/en.min.js"></script>
	<!--  required from filters plugin -->
	<script type="text/javascript" src="../moment/moment.min.js"></script>

	<!--  DATAGRID plugin -->
	<link rel="stylesheet" type="text/css" href="../bs_grid/jquery.bs_grid.min.css">
	<script type="text/javascript" src="../bs_grid/jquery.bs_grid.min.js"></script>
	<script type="text/javascript" src="../bs_grid/localization/en.js"></script>

	<!--  three.js -->
	<script src="../three/js/build/three.js"></script>
	<script src="../three/js/Detector.js"></script>
	<script src="../three/js/controls/OrbitControls.js"></script>
	<script src="../three/js/loaders/DDSLoader.js"></script>
	<script src="../three/js/loaders/MTLLoader.js"></script>
	<script src="../three/js/loaders/OBJLoader.js"></script>
	<!--  3dzs -->
	<script src="../lee_js/3Dzs.js"></script>
	
	<script>
		//全局变量
		var gSceneNum=0;//scene number
		var gSensorNum=0;//sensor number   
		var gSceneID=0;//the current scene
		var gSceneList=new Array();//gSensorVector inside
		var gSensorVector =new Array();//the current sensor posision,THREE.Vector3 inside
		var gRadius=6; //
		//全局函数
		function ss3dzs()
		{
			
						init(gSensorNum,gSensorVector);
						if(gSceneID==0)//demo mode
						{
							animate(true);
						}
						else 
						{
							animate(false);
						}
						
		}
		//++++++++++++++  init +++++++++++++++++++++++++++
		//在没有选择场景之前，展示demo
		var vector=new Array();
		gSensorNum=8
		for(var j=0;j<gSensorNum;j++)
		{
				vector[j]=new THREE.Vector3(gRadius*Math.cos((2*Math.PI/gSensorNum)*j),gRadius*Math.sin((2*Math.PI/gSensorNum)*j),0);
		}
		gSensorVector=vector;
		gSceneList[0]=vector;

		//get scene
		$.post("/select_scenes",
  					{name:"table",col:"ID"},
						function(data,status)
						{
							if(status=="success")
							{ 
								gSceneNum=data.rowCount;
								for(var i=0;i<gSceneNum;i++)
								{
									var str1="No sensor!";
									var sensorVector=[];
									if(data.rows[i].SENSOR != null)
									{
										var  sensor=data.rows[i].SENSOR;
										var sensor_num=sensor.sensors.length;
										
										str1="";
										for(var j=0;j<sensor_num;j++)
										{
											str1=str1+"   编号:"+sensor.sensors[j].id+" 放置角度："+sensor.sensors[j].angle;
											
											//get posision of sensor
											var angle=((sensor.sensors[j].angle)/360)*2*Math.PI;//;
											var vector=new THREE.Vector3(gRadius*Math.cos(i*angle),gRadius*Math.sin(i*angle),0);
											sensorVector[j]=vector;
											
										}
									}
									gSceneList[i+1]=sensorVector;
									var str2="<option value='"+data.rows[i].ID+"'> 场景"+data.rows[i].ID+": "+data.rows[i].NAME+"  描述："+data.rows[i].DESC+"  传感器分布："+str1+"</option>";
									$("#select_scene").append(str2); //为Select追加一个Option(下拉项) 
  								//$("#select_scene").prepend("<option value='0'>请选择</option>"); //为Select插入一个Option(第一个位置)
								}
							}
							else
								alert("读数据库失败，系统将无法正常工作！");
						}
				);
		//+++++++++++++++++++++++++++++++++++++++++
	</script>
	
	
	
	<script>
  	$(function() {
    	$( "#tabs" ).tabs();
  	});
  </script>	
  <script>
  	$(function() {
  		
 					
					$("#select_scene").change(function(){
					
						//var checkText=$("#select_scene").find("option:selected").text(); //获取Select选择的Text 
						//alert("checkText:"+checkText);
						//var checkValue=$("#select_scene").val(); //获取Select选择的Value 
						//alert("checkValue:"+checkValue);
						gSceneID=$("#select_scene").val()
						alert("gSceneID:"+gSceneID);
						gSensorVector=gSceneList[gSceneID];
            gSensorNum=gSensorVector.length;
						$("#3dzs_canvas").empty(); 
						ss3dzs()
					}); //为Select添加选择事件 
			});
				</script>
  <script>
	  $(function() {

			$("#cjwh_grid").bs_grid({

	        //ajaxFetchDataURL: "ajax_fetch_page_data.php",
	        row_primary_key: "customer_id",
					//bootstrap_version: "3",
	        columns: [
	            {field: "customer_id", header: "Code", visible: "no"},
	            {field: "lastname", header: "Lastname"},
	            {field: "firstname", header: "Firstname"},
	            {field: "email", header: "Email", visible: "no", "sortable": "no"},
	            {field: "gender", header: "Gender"},
	            {field: "date_updated", header: "Date updated"}
	        ],

	        sorting: [
	            {sortingName: "Code", field: "customer_id", order: "none"},
	            {sortingName: "Lastname", field: "lastname", order: "ascending"},
	            {sortingName: "Firstname", field: "firstname", order: "ascending"},
	            {sortingName: "Date updated", field: "date_updated", order: "none"}
	        ],

	        filterOptions: {
	            filters: [
	                {
	                    filterName: "Lastname", "filterType": "text", field: "lastname", filterLabel: "Last name",
	                    excluded_operators: ["in", "not_in"],
	                    filter_interface: [
	                        {
	                            filter_element: "input",
	                            filter_element_attributes: {"type": "text"}
	                        }
	                    ]
	                },
	                {
	                    filterName: "Gender", "filterType": "number", "numberType": "integer", field: "lk_genders_id", filterLabel: "Gender",
	                    excluded_operators: ["equal", "not_equal", "less", "less_or_equal", "greater", "greater_or_equal"],
	                    filter_interface: [
	                        {
	                            filter_element: "input",
	                            filter_element_attributes: {type: "checkbox"}
	                        }
	                    ],
	                    lookup_values: [
	                        {lk_option: "Male", lk_value: "1"},
	                        {lk_option: "Female", lk_value: "2", lk_selected: "yes"}
	                    ]
	                },
	                {
	                    filterName: "DateUpdated", "filterType": "date", field: "date_updated", filterLabel: "Datetime updated",
	                    excluded_operators: ["in", "not_in"],
	                    filter_interface: [
	                        {
	                            filter_element: "input",
	                            filter_element_attributes: {
	                                type: "text",
	                                title: "Set the date and time using format: dd/mm/yyyy hh:mm:ss"
	                            },
	                            filter_widget: "datetimepicker",
	                            filter_widget_properties: {
	                                dateFormat: "dd/mm/yy",
	                                timeFormat: "HH:mm:ss",
	                                changeMonth: true,
	                                changeYear: true,
	                                showSecond: true
	                            }
	                        }
	                    ],
	                    validate_dateformat: ["DD/MM/YYYY HH:mm:ss"],
	                    filter_value_conversion: {
	                        function_name: "local_datetime_to_UTC_timestamp",
	                        args: [
	                            {"filter_value": "yes"},
	                            {"value": "DD/MM/YYYY HH:mm:ss"}
	                        ]
	                    }
	                }
	            ]
	        }
	    });
		});
	</script>
	  	
</head>
<body>
	
	<div class="page-header">
		<h1 style="font-family:'微软雅黑';">酷联科技 
			<small style="font-family:'微软雅黑';">    井盖磁场测试系统</small> 
		</h1>
	</div>
	<div id=tabs >
		<ul id="tab0">
	   	<li class="active">  <a href="#3dzs" data-toggle="tab"> 3D实时展示 </a>  	</li>
	   	<li><a href="#3dhzs"  data-toggle="tab">3D历史展示</a></li>
	   	<li><a href="#cjwh" data-toggle="tab">场景维护</a></li>
	   	<li><a href="#glcj"  data-toggle="tab">关联场景</a></li>
		</ul>

		<div id="myTabContent" class="tab-content">
			 
	  	<div class="tab-pane fade in active" id="3dzs" >
	  		
	  		<form action="">
	  		<label for="name" >当前测试场景</label>
					<select id="select_scene" class="scene_list">
						<option value=0 >请选择场景！</option>
					</select>
	  		</form>
	  		
	  		
	  		<div id="3dzs_canvas" >
	  			
					<script>
						ss3dzs()
					
					</script>
				</div>
			</div>
			
			<div class="tab-pane fade in active" id="3dhzs">
			 <p>3d历史 </p>
			</div>
	   
	   	<div class="tab-pane fade" id="cjwh">
	      <p>场景维护 </p>
	   		  
	      <div id="cjwh_grid" title="hello">
	      	
					
	      </div>
	
	      
	   	</div>
	   
	    <div class="tab-pane fade" id="glcj">
	      <p>关联场景</p>
	        <div id="glcj_grid">
	      	
					
	      </div>
	   	</div>
	  
		</div>
	</div>
</body>
</html>
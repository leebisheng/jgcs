<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" > 
	<meta http-equiv="Content-Type" content="text/css .css; charset=utf-8" > 
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>云南酷联科技有限公司</title>
	
	<!--  JQUERY -->
	<script src="../bootstrap-3.3.7-dist/js/jquery-3.1.1.min.js"></script>

	<!--  BOOTSTRAP -->
	<link href="../bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="../bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

  <!--  JQUERY-UI (only sortable and datepicker is needed) -->
	<link rel="stylesheet" type="text/css" href="../jquery-ui-1.12.1/jquery-ui.min.css">
	<script type="text/javascript" src="../jquery-ui-1.12.1/jquery-ui.min.js"></script>
	
	<!--  if timepicker is used in filters -->
	<link rel="stylesheet" type="text/css" href="../timepicker/jquery-ui-timepicker-addon.min.css"/>
	<script type="text/javascript" src="../timepicker/jquery-ui-timepicker-addon.min.js"></script>
	<!--  if touch event support is needed (mobile devices) -->
	<script type="text/javascript" src="../timepicker/jquery.ui.touch-punch.min.js"></script>
 
	<!--  PAGINATION plugin -->
	<link rel="stylesheet" type="text/css" href="../bs_pagination/jquery.bs_pagination.min.css">
	<script type="text/javascript" src="../bs_pagination/jquery.bs_pagination.min.js"></script>
	<script type="text/javascript" src="../bs_pagination/localization/en.min.js"></script>

	<!--  FILTERS plugin --> 
	<link rel="stylesheet" type="text/css" href="../jui_filter_rules/jquery.jui_filter_rules.bs.min.css">
	<script type="text/javascript" src="../jui_filter_rules/jquery.jui_filter_rules.min.js"></script>
	<script type="text/javascript" src="../jui_filter_rules/localization/en.min.js"></script>
	<!--  required from filters plugin -->
	<script type="text/javascript" src="../moment/moment.min.js"></script>

	<!--  DATAGRID plugin -->
	<link rel="stylesheet" type="text/css" href="../bs_grid/jquery.bs_grid.min.css">
	<script type="text/javascript" src="../bs_grid/jquery.bs_grid.min.js"></script>
	<script type="text/javascript" src="../bs_grid/localization/en.js"></script>
	
	<!--  DATATABLE plugin -->
	<link rel="stylesheet" type="text/css" href="../datatable/css/dataTables.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../datatable/css/buttons.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../datatable/css/select.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../datatable/css/editor.bootstrap.min.css">
	
	<script type="text/javascript" src="../datatable/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="../datatable/js/dataTables.bootstrap.min.js"></script>
	<script type="text/javascript" src="../datatable/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" src="../datatable/js/buttons.bootstrap.min.js"></script>	
	<script type="text/javascript" src="../datatable/js/dataTables.select.min.js"></script>

	<script type="text/javascript" src="../datatable/js/dataTables.editor.min.js"></script>
	<script type="text/javascript" src="../datatable/js/editor.bootstrap.min.js"></script>

	
	<!--  three.js -->
	<script src="../three/js/build/three.js"></script>
	<script src="../three/js/Detector.js"></script>
	<script src="../three/js/controls/OrbitControls.js"></script>
	<script src="../three/js/loaders/DDSLoader.js"></script>
	<script src="../three/js/loaders/MTLLoader.js"></script>
	<script src="../three/js/loaders/OBJLoader.js"></script>
	<!--  3dzs -->
	<script src="../lee_js/3Dzs.js"></script>
	
	<script>
		//全局变量
		var gSceneNum=0;//scene number
		var gSensorNum=0;//sensor number   
		var gSceneID=0;//the current scene
		var gSceneList=new Array();//gSensorVector inside
		var gSensorVector =new Array();//the current sensor posision,THREE.Vector3 inside
		var gRadius=6; //
		
		var editor; // use a global for the submit and return data rendering in the examples
		//全局函数
		function ss3dzs()
		{
			
						init(gSensorNum,gSensorVector);
						if(gSceneID==0)//demo mode
						{
							animate(true);
						}
						else 
						{
							animate(false);
						}
						
		}
		//++++++++++++++  init +++++++++++++++++++++++++++
		//在没有选择场景之前，展示demo
		var vector=new Array();
		gSensorNum=8;//  
		for(var j=0;j<gSensorNum;j++)
		{
				vector[j]=new THREE.Vector3(gRadius*Math.cos((2*Math.PI/gSensorNum)*j),gRadius*Math.sin((2*Math.PI/gSensorNum)*j),0);
		}
		gSensorVector=vector;
		gSceneList[0]=vector;

		//get scene
		$.post("/select_scenes",
  					{name:"table",col:"ID"},
						function(data,status)
						{
							if(status=="success")
							{ 
								gSceneNum=data.rowCount;
								for(var i=0;i<gSceneNum;i++)
								{
									var str1="No sensor!";
									var sensorVector=[];
									if(data.rows[i].SENSOR != null)//SENSOR is object
									{
										var  sensor=data.rows[i].SENSOR;
										var sensor_num=sensor.sensors.length;
										
										str1="";
										for(var j=0;j<sensor_num;j++)
										{
											str1=str1+"   编号:"+sensor.sensors[j].id+" 放置角度："+sensor.sensors[j].angle;
											//get posision of sensor
											var angle=((sensor.sensors[j].angle)/360)*2*Math.PI;//;
											var vector=new THREE.Vector3(gRadius*Math.cos(i*angle),gRadius*Math.sin(i*angle),0);
											sensorVector[j]=vector;
											
										}
									}
									gSceneList[i+1]=sensorVector;
									var str2="<option value='"+data.rows[i].ID+"'> 场景"+data.rows[i].ID+": "+data.rows[i].NAME+"  描述："+data.rows[i].DESC+"  传感器分布："+str1+"</option>";
									$("#select_scene").append(str2); //为Select追加一个Option(下拉项) 
  								//$("#select_scene").prepend("<option value='0'>请选择</option>"); //为Select插入一个Option(第一个位置)
								}
							}
							else
								alert("读数据库失败，系统将无法正常工作！");
						}
				);
		//+++++++++++++++++++++++++++++++++++++++++
	</script>
		
	<script>
  	$(function() {
    	$( "#tabs" ).tabs();
  	});
  </script>	
  <script>
  	//处理场景选择
  	$(function() {
  		
 					
					$("#select_scene").change(function(){
					
						//var checkText=$("#select_scene").find("option:selected").text(); //获取Select选择的Text 
						//alert("checkText:"+checkText);
						//var checkValue=$("#select_scene").val(); //获取Select选择的Value 
						//alert("checkValue:"+checkValue);
						gSceneID=$("#select_scene").val()
						//alert("gSceneID:"+gSceneID);
						gSensorVector=gSceneList[gSceneID];
            gSensorNum=gSensorVector.length;
						$("#3dzs_canvas").empty(); 
						ss3dzs()
					}); //为Select添加选择事件 
			});
	</script>
  
  <script>
  
		$(function() {
		    editor = new $.fn.dataTable.Editor( {
		        ajax: "",
		        table: "#scene_table",
		        idSrc:  'ID',
		        fields: [  {
		                label: "场景名称:",
		                name: "NAME"
		            }, {
		                label: "场景描述:",
		                name: "DESC"
		            }, {
		                label: "传感器:",
		                name: "SENSOR"
		            }, {
		                label: "创建时间:",
		                name: "CREATE_TIME"
		            }
		        ]
		    } );
		    
		   	    
		    var table = $('#scene_table').DataTable( {
		      ajax:"/select_scenes_d",
		       columns: [
		       	{ data: "ID" },
		       	{ data: "NAME" },
		       	{ data: "DESC" },
		      	{ data: "SENSOR" },
		        { data: "CREATE_TIME" }
		        ],
		        order: [ 1, 'asc' ],
        		select: true
		    } );
		 
		    // Display the buttons
		    //new $.fn.dataTable.Buttons( table, [
		    //    { extend: "create", editor: editor },
		       // { extend: "edit",   editor: editor },
		     //   { extend: "remove", editor: editor }
		    //] );
		 
		    table.buttons().container()
		        .appendTo( $('.col-sm-6:eq(0)', table.table().container() ) );
		        
		      
		      $('#scene_table tbody').on( 'click', 'tr', function () {
		        if ( $(this).hasClass('selected') ) {
		            $(this).removeClass('selected');
		        }
		        else {
		            table.$('tr.selected').removeClass('selected');
		            $(this).addClass('selected');
		        }
		    	} ); 
		        		
    		 $('#scene_table').on( 'click', 'tbody td:not(:first-child)', function (e) {
        		editor.inline( this);
    			} );
    			
    		 $('#delRow').click( function () {
    		 		if(confirm("是否删除?"))		table.row('.selected').remove().draw( false );
    			} );
    			
    		 $('#addRow').click( function () {
        		 
    			} );
    
		} );
	</script>	  	
	
</head>
<body>
	
	<div class="page-header">
		<h1 style="font-family:'微软雅黑';">酷联科技 
			<small style="font-family:'微软雅黑';">    井盖磁场测试系统</small> 
		</h1>
	</div>
	<div id=tabs >
		<ul id="tab0">
	   	<li class="active">  <a href="#3dzs" data-toggle="tab"> 3D实时展示 </a>  	</li>
	   	<li><a href="#3dhzs"  data-toggle="tab">3D历史展示</a></li>
	   	<li><a href="#cjwh" data-toggle="tab">场景维护</a></li>
	   	<li><a href="#glcj"  data-toggle="tab">关联场景</a></li>
		</ul>

		<div id="myTabContent" class="tab-content">
			 
	  	<div class="tab-pane fade in active" id="3dzs" >
	  		
	  		<form action="">
	  		<label for="name" >当前测试场景</label>
					<select id="select_scene" class="scene_list">
						<option value=0 >请选择场景！</option>
					</select>
	  		</form>
	  		
	  		
	  		<div id="3dzs_canvas" >
	  			
					<script>
						ss3dzs()
					
					</script>
				</div>
			</div>
			
			<div class="tab-pane fade " id="3dhzs">
			 <p>3d历史 </p>
			</div>
	   
	   	<div class="tab-pane fade" id="cjwh">
		    <table id="scene_table" class="table table-striped table-bordered" cellspacing="0" width="100%">
	        <thead>
	            <tr>
	                <th>场景编号</th>
	                <th>场景名称</th>
	                <th>场景描述</th>
	                <th>传感器  </th>
	                <th>创建时间</th>
	            </tr>
	        </thead>

	         <tbody></tbody>
	         
	    	</table>  
	    	<p>
				  <button id="addRow" type="button" class="btn btn-info bt-sm">新增</button>
					<button id="delRow" type="button" class="btn btn-danger bt-sm">删除</button>
				</p>
	   	</div>
	   
	    <div class="tab-pane fade" id="glcj">

	   	</div>
	  
		</div>
	</div>
</body>
</html>